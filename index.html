<!DOCTYPE html>
<html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mega Social</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pro Social Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
<style>
body{margin:0;font-family:Arial;background:#f0f2f5}
.nav{background:#1877f2;color:white;padding:12px}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:white;padding:15px;border-radius:10px;margin-bottom:15px}
button{padding:6px 12px;margin-top:5px;cursor:pointer}
input,textarea{width:100%;padding:8px;margin:5px 0}
img{max-width:100%;border-radius:8px}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Segoe UI",Calibri,sans-serif;
  background:#eef2f7;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:420px;
  background:#fff;
  padding:30px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.hidden{display:none}
input,textarea{
  width:100%;
  padding:11px;
  margin:8px 0;
  border-radius:10px;
  border:1.5px solid #ccc;
  font-size:14px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#1877f2;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
/* ===== HOME ===== */
#home{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  background:#f0f2f5;
}
.topbar{
  background:#1877f2;
  color:#fff;
  padding:14px 20px;
  font-size:20px;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.layout{
  flex:1;
  display:grid;
  grid-template-columns:260px 1fr 320px;
  gap:16px;
  padding:16px;
}
.panel{
  background:#fff;
  border-radius:14px;
  padding:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  overflow:auto;
}
.feed-post{
  border:1px solid #eee;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}
.reactions span{
  cursor:pointer;
  margin-right:10px;
  font-size:18px;
}
.chat-box{
  height:320px;
  overflow:auto;
  border:1px solid #eee;
  border-radius:10px;
  padding:8px;
  margin-bottom:8px;
  background:#fafafa;
}
.friend-item{
  padding:8px;
  border-bottom:1px solid #eee;
  display:flex;
  justify-content:space-between;
}
.center-text{
  text-align:center;
}
</style>
</head>
<body>

<div class="nav">Mega Social</div>
<div id="auth" class="container">
<h3>Login / Signup</h3>
<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Password">
<button onclick="signup()">Signup</button>
<button onclick="login()">Login</button>
<!-- LOGIN -->
<div id="login" class="card">
  <h2 class="center-text">Login</h2>
  <input id="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <button style="margin-top:8px;background:#42b72a" onclick="register()">Create Account</button>
</div>

<div id="app" style="display:none" class="container">
<button onclick="logout()">Logout</button>
<!-- HOME -->
<div id="home" class="hidden">
  <div class="topbar">
    <div>Pro Social</div>
    <button style="width:auto;padding:6px 12px;background:#fff;color:#1877f2" onclick="logout()">Logout</button>
  </div>

<div class="card">
<h3>Create Post</h3>
<textarea id="postText" placeholder="What's on your mind?"></textarea>
<input type="file" id="postImage">
<button onclick="createPost()">Post</button>
</div>
  <div class="layout">

<div id="feed"></div>
    <!-- FRIENDS -->
    <div class="panel">
      <h3>Find Friends</h3>
      <input id="searchUser" placeholder="Search email" oninput="searchUsers()" />
      <div id="searchResults"></div>

<div class="card">
<h3>Private Chat</h3>
<input id="chatUser" placeholder="Other User UID">
<div id="messages"></div>
<input id="chatText" placeholder="Message">
<button onclick="sendMessage()">Send</button>
</div>
      <h3 style="margin-top:12px">My Friends</h3>
      <div id="friendsList"></div>
    </div>

</div>
    <!-- FEED -->
    <div class="panel">
      <h3>Create Post</h3>
      <textarea id="postText" placeholder="What's on your mind?"></textarea>
      <button onclick="createPost()">Post</button>

<script type="module">
      <h3 style="margin-top:14px">Realtime Feed</h3>
      <div id="feed"></div>
    </div>

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword,
signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    <!-- CHAT -->
    <div class="panel">
      <h3>Realtime Chat</h3>
      <div id="chatBox" class="chat-box"></div>
      <input id="chatMsg" placeholder="Type message + Enter" />
      <button onclick="sendMessage()">Send</button>
    </div>

import {
getFirestore, collection, addDoc, setDoc,
doc, updateDoc, getDoc, onSnapshot,
query, orderBy, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  </div>
</div>

import { getStorage, ref, uploadBytes, getDownloadURL }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, setDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// üî• PUT YOUR CONFIG HERE
/* üî• PUT YOUR REAL CONFIG HERE */
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_BUCKET",
  appId: "YOUR_APP_ID"
};
    apiKey: "AIzaSyBc-ie4WnBkVMfrb5halHIaKWHGyy3zGC4",
    authDomain: "website-ab5ea.firebaseapp.com",
    projectId: "website-ab5ea",
    storageBucket: "website-ab5ea.firebasestorage.app",
    messagingSenderId: "1094491609955",
    appId: "1:1094491609955:web:4ac93d44c03490cd3d5156"
  };

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const storage = getStorage();
// AUTH
window.signup = async ()=>{
  const cred = await createUserWithEmailAndPassword(auth,email.value,pass.value);
  await setDoc(doc(db,"users",cred.user.uid),{
    name:name.value,
    createdAt:serverTimestamp()
  });
};
const auth = getAuth(app);
const db = getFirestore(app);
let currentUser = null;

window.login = async ()=>{
  await signInWithEmailAndPassword(auth,email.value,pass.value);
/* ===== AUTH ===== */
window.register = async () => {
  await createUserWithEmailAndPassword(auth, email.value, password.value);
};

window.logout = ()=>signOut(auth);
window.login = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

// CREATE POST
window.createPost = async ()=>{
  const user = auth.currentUser;
  let imageUrl="";
window.logout = () => signOut(auth);

  if(postImage.files[0]){
    const imageRef = ref(storage,"posts/"+Date.now());
    await uploadBytes(imageRef,postImage.files[0]);
    imageUrl = await getDownloadURL(imageRef);
onAuthStateChanged(auth, async user => {
  if (user) {
    currentUser = user;
    login.classList.add("hidden");
    home.classList.remove("hidden");
    initRealtime();
  } else {
    currentUser = null;
    home.classList.add("hidden");
    login.classList.remove("hidden");
  }
});

  await addDoc(collection(db,"posts"),{
    uid:user.uid,
    text:postText.value,
    image:imageUrl,
    likes:[],
    createdAt:serverTimestamp()
/* ===== POSTS REALTIME ===== */
window.createPost = async () => {
  if (!postText.value.trim()) return;
  await addDoc(collection(db, "posts"), {
    text: postText.value,
    uid: currentUser.uid,
    time: serverTimestamp(),
    likes: 0
  });
  postText.value="";
  postText.value = "";
};

// REALTIME FEED
function loadFeed(){
  const q = query(collection(db,"posts"),orderBy("createdAt","desc"));
  onSnapshot(q,snap=>{
    feed.innerHTML="";
    snap.forEach(docSnap=>{
      const p = docSnap.data();
      feed.innerHTML+=`
        <div class="card">
          <p>${p.text}</p>
          ${p.image?`<img src="${p.image}">`:""}
          <button onclick="likePost('${docSnap.id}')">
            ‚ù§Ô∏è ${p.likes.length}
          </button>
          <div id="comments-${docSnap.id}"></div>
          <input placeholder="Comment"
          onkeypress="if(event.key==='Enter') addComment('${docSnap.id}',this.value)">
        </div>
      `;
      loadComments(docSnap.id);
    });
/* ===== CHAT REALTIME ===== */
window.sendMessage = async () => {
  if (!chatMsg.value.trim()) return;
  await addDoc(collection(db, "messages"), {
    text: chatMsg.value,
    uid: currentUser.uid,
    time: serverTimestamp()
  });
}
  chatMsg.value = "";
};
chatMsg.addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});

// LIKE
window.likePost = async (id)=>{
  const refDoc = doc(db,"posts",id);
  const snap = await getDoc(refDoc);
  let likes = snap.data().likes;
/* ===== FRIEND SEARCH ===== */
window.searchUsers = async () => {
  searchResults.innerHTML = "Searching...";

  if(!likes.includes(auth.currentUser.uid)){
    likes.push(auth.currentUser.uid);
    await updateDoc(refDoc,{likes});
  }
  const q = query(collection(db, "users"));
  const snap = await getDocs(q);
  searchResults.innerHTML = "";
  snap.forEach(d => {
    const u = d.data();
    if (u.email.includes(searchUser.value) && u.uid !== currentUser.uid) {
      searchResults.innerHTML += `
        <div class="friend-item">
          <span>${u.email}</span>
          <button onclick="addFriend('${u.uid}')">Add</button>
        </div>`;
    }
  });
};

// COMMENT
window.addComment = async (postId,text)=>{
  await addDoc(collection(db,"posts",postId,"comments"),{
    uid:auth.currentUser.uid,
    text,
    createdAt:serverTimestamp()
window.addFriend = async (uid) => {
  await setDoc(doc(db, "friends", currentUser.uid + "_" + uid), {
    users: [currentUser.uid, uid]
  });
  alert("Friend added realtime");
};

// LOAD COMMENTS
function loadComments(postId){
  const q=query(collection(db,"posts",postId,"comments"),orderBy("createdAt"));
  onSnapshot(q,snap=>{
    let html="";
    snap.forEach(d=>{
      html+=`<p>üí¨ ${d.data().text}</p>`;
    });
    document.getElementById("comments-"+postId).innerHTML=html;
/* ===== REALTIME INIT ===== */
function initRealtime() {
  // save self profile
  setDoc(doc(db, "users", currentUser.uid), {
    uid: currentUser.uid,
    email: currentUser.email
  });
}

// PRIVATE CHAT
window.sendMessage = async ()=>{
  const chatId = [auth.currentUser.uid,chatUser.value].sort().join("_");
  await addDoc(collection(db,"chats",chatId,"messages"),{
    from:auth.currentUser.uid,
    text:chatText.value,
    createdAt:serverTimestamp()
  // realtime posts
  const pq = query(collection(db, "posts"), orderBy("time", "desc"));
  onSnapshot(pq, snap => {
    feed.innerHTML = "";
    snap.forEach(d => {
      const p = d.data();
      feed.innerHTML += `
        <div class="feed-post">
          <b>${p.uid.slice(0,6)}</b><br>
          ${p.text}
          <div class="reactions">
            <span onclick="react('${d.id}')">üëç</span>
          </div>
        </div>`;
    });
  });
  chatText.value="";
  loadMessages();
};

function loadMessages(){
  const chatId = [auth.currentUser.uid,chatUser.value].sort().join("_");
  const q=query(collection(db,"chats",chatId,"messages"),orderBy("createdAt"));
  onSnapshot(q,snap=>{
    messages.innerHTML="";
    snap.forEach(d=>{
      messages.innerHTML+=`<div>${d.data().text}</div>`;
  // realtime chat
  const cq = query(collection(db, "messages"), orderBy("time"));
  onSnapshot(cq, snap => {
    chatBox.innerHTML = "";
    snap.forEach(d => {
      const m = d.data();
      chatBox.innerHTML += `<div><b>${m.uid.slice(0,6)}:</b> ${m.text}</div>`;
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

// INIT
onAuthStateChanged(auth,user=>{
  if(user){
    auth.style.display="none";
    app.style.display="block";
    loadFeed();
  }
});
/* ===== REACTION ===== */
window.react = async (postId) => {
  const ref = doc(db, "posts", postId);
  await setDoc(ref, { likes: 1 }, { merge: true });
};

</script>
    </body>
