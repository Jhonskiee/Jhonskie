<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MySocial</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#eef2f7;
}

/* ---------- CENTER LOGIN ---------- */
.centerWrap{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:360px;
  background:#fff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.12);
  text-align:center;
}

.hidden{display:none}

input{
  width:100%;
  padding:13px;
  margin:8px 0;
  border-radius:14px;
  border:1px solid #ddd;
}

button{
  width:100%;
  padding:13px;
  border:none;
  border-radius:14px;
  background:#1877f2;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

.link{
  margin-top:10px;
  color:#1877f2;
  cursor:pointer;
}

/* ---------- HOME ---------- */
#home{
  display:flex;
  flex-direction:column;
  height:100vh;
}

.navbar{
  background:#1877f2;
  color:#fff;
  padding:14px 22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.main{
  flex:1;
  display:flex;
  gap:14px;
  padding:14px;
}

/* ---------- SIDEBAR ---------- */
.sidebar{
  width:260px;
  background:#fff;
  border-radius:16px;
  padding:14px;
  overflow:auto;
}

/* ---------- CHAT ---------- */
.chat{
  flex:1;
  background:#fff;
  border-radius:16px;
  padding:14px;
  display:flex;
  flex-direction:column;
}

#chatWindow{
  flex:1;
  overflow:auto;
  display:flex;
  flex-direction:column;
}

.msg{
  padding:10px 14px;
  border-radius:16px;
  margin:6px 0;
  max-width:70%;
}

.self{
  background:#1877f2;
  color:#fff;
  align-self:flex-end;
}

.other{
  background:#e4e6eb;
  align-self:flex-start;
}

.reactBtn{
  cursor:pointer;
  margin-right:6px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginWrap" class="centerWrap">
  <div class="card">
    <h2>Login</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div class="link" onclick="showRegister()">Create account</div>
  </div>
</div>

<!-- REGISTER -->
<div id="registerWrap" class="centerWrap hidden">
  <div class="card">
    <h2>Create Account</h2>
    <input id="regEmail" placeholder="Email">
    <input id="regPass" type="password" placeholder="Password">
    <button onclick="register()">Register</button>
    <div class="link" onclick="showLogin()">Back to login</div>
  </div>
</div>

<!-- HOME -->
<div id="home" class="hidden">
  <div class="navbar">
    <strong>MySocial</strong>
    <button style="width:auto;background:#ff3b30;padding:6px 14px" onclick="logout()">Logout</button>
  </div>

  <div class="main">
    <div class="sidebar">
      <h3>Find Friends</h3>
      <input id="searchEmail" placeholder="Search email">
      <button onclick="searchUser()">Search</button>
      <div id="searchResult"></div>
    </div>

    <div class="chat">
      <div id="chatWindow"></div>
      <input id="chatInput" placeholder="Type message and press Enter">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<script>
// üî¥ PUT YOUR REAL FIREBASE CONFIG
 const firebaseConfig = {
    apiKey: "AIzaSyBc-ie4WnBkVMfrb5halHIaKWHGyy3zGC4",
    authDomain: "website-ab5ea.firebaseapp.com",
    projectId: "website-ab5ea",
    storageBucket: "website-ab5ea.firebasestorage.app",
    messagingSenderId: "1094491609955",
    appId: "1:1094491609955:web:4ac93d44c03490cd3d5156"
  };
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;
let unsubscribeChat=null;

/* ---------- NAV ---------- */
function showRegister(){
  loginWrap.classList.add("hidden");
  registerWrap.classList.remove("hidden");
}
function showLogin(){
  registerWrap.classList.add("hidden");
  loginWrap.classList.remove("hidden");
}

/* ---------- AUTH ---------- */
function register(){
  auth.createUserWithEmailAndPassword(regEmail.value,regPass.value)
  .then(cred=>{
    return db.collection("users").doc(cred.user.uid).set({
      email:regEmail.value
    });
  })
  .then(()=>alert("Account created"))
  .catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(loginEmail.value,loginPass.value)
  .catch(e=>alert(e.message));
}

function logout(){
  if(unsubscribeChat) unsubscribeChat();
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    loginWrap.classList.add("hidden");
    registerWrap.classList.add("hidden");
    home.classList.remove("hidden");
    startChat();
  }else{
    home.classList.add("hidden");
    loginWrap.classList.remove("hidden");
    if(unsubscribeChat) unsubscribeChat();
  }
});

/* ---------- CHAT ---------- */
function sendMessage(){
  const text=chatInput.value.trim();
  if(!text || !currentUser) return;

  db.collection("messages").add({
    uid:currentUser.uid,
    text:text,
    reactions:{},
    time:Date.now()
  });

  chatInput.value="";
}

chatInput.addEventListener("keydown",e=>{
  if(e.key==="Enter") sendMessage();
});

function startChat(){
  unsubscribeChat=db.collection("messages")
  .orderBy("time")
  .onSnapshot(snap=>{
    chatWindow.innerHTML="";
    snap.forEach(doc=>{
      const m=doc.data();
      const r=m.reactions||{};
      const div=document.createElement("div");
      div.className="msg "+(m.uid===currentUser.uid?"self":"other");
      div.innerHTML=`
        <div>${m.text}</div>
        <small>
          üëç ${r.like||0}
          ‚ù§Ô∏è ${r.love||0}
          üòÇ ${r.laugh||0}
        </small><br>
        <span class="reactBtn" onclick="react('${doc.id}','like')">üëç</span>
        <span class="reactBtn" onclick="react('${doc.id}','love')">‚ù§Ô∏è</span>
        <span class="reactBtn" onclick="react('${doc.id}','laugh')">üòÇ</span>
      `;
      chatWindow.appendChild(div);
    });
    chatWindow.scrollTop=chatWindow.scrollHeight;
  });
}

function react(id,type){
  const ref=db.collection("messages").doc(id);
  db.runTransaction(async t=>{
    const doc=await t.get(ref);
    const r=doc.data().reactions||{};
    r[type]=(r[type]||0)+1;
    t.update(ref,{reactions:r});
  });
}

/* ---------- SEARCH USER ---------- */
async function searchUser(){
  const email=searchEmail.value.trim();
  const snap=await db.collection("users")
    .where("email","==",email).get();

  if(snap.empty){
    searchResult.innerHTML="User not found";
    return;
  }

  searchResult.innerHTML="User found ‚úÖ";
}
</script>
</body>
</html>
